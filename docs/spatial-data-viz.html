<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ujaval Gandhi" />


<title>Spatial Data Visualization and Analytics (Course Material)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Spatial Data Visualization and Analytics (Course Material)</h1>
<h3 class="subtitle">A modern introduction to working with spatial datasets</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#why-do-we-care-about-location">Why do we care about location?</a></li>
<li><a href="#location-data-is-everywhere">Location data is everywhere</a></li>
<li><a href="#spatial-data-model">Spatial Data Model</a></li>
<li><a href="#spatial-data-formats">Spatial Data Formats</a></li>
<li><a href="#spatial-data-types">Spatial Data Types</a></li>
<li><a href="#map-projections-and-coordinate-reference-systems">Map Projections and Coordinate Reference Systems</a></li>
</ul></li>
<li><a href="#introduction-to-qgis">Introduction to QGIS</a><ul>
<li><a href="#plugins">Plugins</a></li>
</ul></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#visualization">Visualization</a><ul>
<li><a href="#points">Points</a><ul>
<li><a href="#exercise-mapping-air-quality">Exercise: Mapping Air Quality</a></li>
</ul></li>
<li><a href="#lines">Lines</a><ul>
<li><a href="#exercise-visualize-gps-tracks">Exercise: Visualize GPS Tracks</a></li>
</ul></li>
<li><a href="#polygons">Polygons</a><ul>
<li><a href="#exercise-mapping-census-data">Exercise: Mapping Census Data</a></li>
</ul></li>
<li><a href="#point-clouds">Point Clouds</a><ul>
<li><a href="#exercise-view-point-cloud-from-an-aerial-survey">Exercise: View Point Cloud from an Aerial Survey</a></li>
</ul></li>
<li><a href="#raster---photos">Raster - Photos</a><ul>
<li><a href="#exercise-view-drone-imagery">Exercise: View Drone Imagery</a></li>
</ul></li>
<li><a href="#raster---satellite-images">Raster - Satellite Images</a><ul>
<li><a href="#exercise-view-sentinel-2-image-and-create-composites">Exercise: View Sentinel-2 Image and Create Composites</a></li>
</ul></li>
<li><a href="#raster---elevation-data">Raster - Elevation Data</a><ul>
<li><a href="#exercise-view-and-compare-dsmdtm">Exercise: View and compare DSM/DTM</a></li>
</ul></li>
</ul></li>
<li><a href="#analysis">Analysis</a><ul>
<li><a href="#exercise-uber-movement-analysis">Exercise: Uber Movement Analysis</a></li>
<li><a href="#exercise-analyze-metro-rail-accesiblity">Exercise: Analyze Metro Rail Accesiblity</a></li>
<li><a href="#exercise-distribution-of-green-spaces">Exercise: Distribution of Green Spaces</a></li>
<li><a href="#exercise-determine-the-best-area-for-a-home">Exercise: Determine the Best Area for a Home</a></li>
</ul></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>


<hr />
<p><strong>This course is also offered as an in-person class. If you would like to attend one of my workshops, visit <a href="https://spatialthoughts.com/events/">www.spatialthoughts.com/events</a> to know details of upcoming classes. You may also sign up for <a href="https://mailchi.mp/1d44f6c0c955/spatialthoughts">my mailing list</a> to know when new sessions are scheduled.</strong></p>
<hr />

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="why-do-we-care-about-location" class="section level2">
<h2>Why do we care about location?</h2>
<blockquote>
<p>“Everything is related to everything else, but near things are more related than distant things.” - Waldo Tobler’s <a href="https://en.wikipedia.org/wiki/Tobler%27s_first_law_of_geography">First Law of Geopraphy</a></p>
</blockquote>
<p>When modeling and analyzing our world, location is a critical factor. A non-spatial model cannot accurately reflect the processes and interactions happening in our world. Take this example - <a href="https://medium.com/geoai/using-forest-based-classification-regression-to-model-and-estimate-house-values-5a0e26682c42">predicting housing prices</a> - where a spatial prediction model performed much better than a purely non-spatial one.</p>
</div>
<div id="location-data-is-everywhere" class="section level2">
<h2>Location data is everywhere</h2>
<p>Today the availability of location data - both for individuals and businesses - has exploded. Spatial data adds another dimension to data, and reveals patterns that are otherwise not obvious.</p>
<p>Individuals - with GPS sensors on their smartphones - have the ability to tag their data with location. Photos taken with smartphones have the location embedded in it. If opted-in, one can store and access their location history on an ongoing basis.</p>
<p>Most businesses have location data in one form or the other. Customer addresses, IP-locations of website visitors, sales territories, supply chain routes and so on. For other businesses - such as taxi aggregators, food delivery, logistics - generate huge amounts of location data that can be mined for intelligence.</p>
<p>IoT (Internet-Of-Things) devices are collecting location data continuously alongside with sensor data.</p>
<p>Governments are also increasing collecting and sharing location based data. Data relating to urban infrastructure, census, LIDAR and aerial imagery etc. are being collected at massive scale. Many governments have implemented open data sharing policies - making this data available to individuals and businesses to use.</p>
</div>
<div id="spatial-data-model" class="section level2">
<h2>Spatial Data Model</h2>
<p>The spatial data model consists of 2 parts: <strong>geometry</strong> + <strong>properties</strong></p>
<p><em>Geometry</em> (Shape) is defined with coordinates and a coordiate reference system <em>Properties</em> (Attributes) is defined with data and data types</p>
<p>Consider the following reprsentation of a city as a point.</p>
<pre><code> {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [ 77.58270263671875, 12.963074139604124]
      },
      &quot;properties&quot;: {
        &quot;id&quot;: 1,
        &quot;name&quot;: &quot;Bengaluru&quot;
      }
  }</code></pre>
<p>This representation is in <a href="https://geojson.org/">GeoJson</a> format. The point geometry is defined with X (Longitude) and Y (Latitude) coordinates. The point is assigned 2 properties - <em>id</em> with a value of <code>1</code>, and <em>name</em> with the value of <code>Bengaluru</code>. The GeoJson format supports only 1 type of Coordinate Reference System (WGS84), so we do not need to specify it explcitely.</p>
</div>
<div id="spatial-data-formats" class="section level2">
<h2>Spatial Data Formats</h2>
<p>We saw a basic way to represent the spatial data. But there is a variety of data formats to represent the data to suit different applications. In most cases, spatial data formats are an extension of existing data formats.</p>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Non-Spatial Data</strong></th>
<th align="left"><strong>Spatial Data</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Text</td>
<td align="left">csv, json, xml</td>
<td align="left">csv, geojson, gml, kml</td>
</tr>
<tr class="even">
<td align="left">Binary/Compressed</td>
<td align="left">pdf, xls, zip</td>
<td align="left">shapefile, geopdf, geopackage</td>
</tr>
<tr class="odd">
<td align="left">Images</td>
<td align="left">tiff, jpg, png</td>
<td align="left">geotiff, jpeg2000</td>
</tr>
<tr class="even">
<td align="left">Databases</td>
<td align="left">SQLite, PostgreSQL, Oracle</td>
<td align="left">Spatialite, PostGIS, Oracle Spatial</td>
</tr>
</tbody>
</table>
</div>
<div id="spatial-data-types" class="section level2">
<h2>Spatial Data Types</h2>
<p>Spatial Data can be broadly categorized into 2 types - Vector and Raster. For serving these data on the web, they are usually cut into smaller chunks (tiles), so they can be categorized as the 3rd type.</p>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Sub Types</strong></th>
<th align="left"><strong>Examples</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Vector</td>
<td align="left">Point</td>
<td align="left"><em>Sensor Observations, Places</em></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Line</td>
<td align="left"><em>GPS Tracks, Roads, Rivers, Contours</em></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Polygons</td>
<td align="left"><em>Administrative Boundaries, Buildings</em></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Point Cloud</td>
<td align="left"><em>LIDAR surveys</em></td>
</tr>
<tr class="odd">
<td align="left">Raster</td>
<td align="left">Photos</td>
<td align="left"><em>Aerial and Drone Photos</em></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Grids</td>
<td align="left"><em>Satellite Imagery, Elevation Data</em></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Mesh</td>
<td align="left"><em>Weather Data, Climate Data</em></td>
</tr>
<tr class="even">
<td align="left">Tiles</td>
<td align="left">Raster Tile Layers</td>
<td align="left"><em>Web Maps</em></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Vector Tile Layers</td>
<td align="left"><em>Web Maps</em></td>
</tr>
</tbody>
</table>
</div>
<div id="map-projections-and-coordinate-reference-systems" class="section level2">
<h2>Map Projections and Coordinate Reference Systems</h2>
<p>If there was one thing that makes spatial data ‘special’ - it would have to be Coordinate Reference System (CRS) or Spatial Reference System (SRS).</p>
<p>A <em>Map Projection</em> transforms the earth from its spherical shape (3D) to a planar shape (2D).</p>
<p>A <em>Coordinate Reference System (CRS)</em> then defines how the 2D map relates to real places on the earth.</p>
<p>The <a href="https://docs.qgis.org/testing/en/docs/gentle_gis_introduction/coordinate_reference_systems.html">QGIS Documentation</a> provides a comprehensive introduction to the topic.</p>
<p>There are hundreds of different map projection and CRS - each with different properties and uses. The most important thing to remember is that every projection distorts the map in some way. This <a href="https://bl.ocks.org/syntagmatic/ba569633d51ebec6ec6e">mashup of map projections distortions</a> provide a useful visual reference to population projection.</p>
<p>So what projection should you use for your project? Often, the answer is - it depends. This being a vast and complex topic, often, the answer is - it depends. But following are guidelines that will help you.</p>
<ul>
<li><strong>Global Maps</strong>: If you are producing global maps, the preferred and modern choice is the <a href="http://equal-earth.com/">Equal Earth</a> projection. Added advantage of this projection is that it preserves areas, so it is also a good choice for global scale analysis that require equal-area grids.</li>
</ul>
<div class="figure">
<img src="images/spatial_data_viz/equal-earth.jpg" alt="The Equal Earth Projection" />
<p class="caption">The <a href="http://equal-earth.com/">Equal Earth</a> Projection</p>
</div>
<ul>
<li><strong>Country Maps</strong>: Most countries have adopted a spcific CRS designed to minimize distortions over the region. You should consult the country’s national mapping agency (USGS, Ordanance Survey, Survey of India etc.) for guidance. For India, the National Spatial Framework (NSF) recommends using the CRS EPSG: 7755 for country-level mapping - which is based on Lambert Conformal Conic (LCC) projection.</li>
</ul>
<div class="figure">
<img src="images/spatial_data_viz/india_map.jpg" alt="India Political Map by Survey of India in LCC Projection" />
<p class="caption">India Political Map by <a href="http://www.surveyofindia.gov.in/pages/display/235-political-map-of-india">Survey of India</a> in LCC Projection</p>
</div>
<ul>
<li><strong>Local and Regional Maps</strong>: Similar to country-level CRSs, most countries have a state/province level CRSs. In absense of them, the Universal Transverse Mercator (UTM) provides a good overall system that can be used in any part of the world. The distortions within each zone is minimized, and if the area of interest is contained within the zone - it is a good choice for analysis as well as mapping. For India, UTM Zones 42N, 43N, 44N, 45N, 46N and 47N are used depending on the where your area of interest is located.</li>
</ul>
<div class="figure">
<img src="images/spatial_data_viz/utm_zones.png" alt="UTM Zones of the world." />
<p class="caption">UTM Zones of the world.</p>
</div>
</div>
</div>
<div id="introduction-to-qgis" class="section level1">
<h1>Introduction to QGIS</h1>
<div id="plugins" class="section level2">
<h2>Plugins</h2>
<ul>
<li>QuickMapServices</li>
<li>TimeManager</li>
<li>QuickOSM</li>
</ul>
</div>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The exercises in this class use a variety of datasets. All the required layers, project files etc. are supplied to you in the <code>spatial_data_viz.zip</code> file. Unzip this file to the <code>Downloads</code> directory.</p>
</div>
<div id="visualization" class="section level1">
<h1>Visualization</h1>
<div id="points" class="section level2">
<h2>Points</h2>
<p>The simplest representation of spatial data can be done using a table. A place can be represented using a pair of coordinates - Latitude and Longitude - with other attribute information about the place. Many spatial data source come in this form. Excel sheets, CSV files, database tables etc.</p>
<div id="exercise-mapping-air-quality" class="section level3">
<h3>Exercise: Mapping Air Quality</h3>
<p>Worsening air quality is a severe problem in many countries around the world. India - particularly - Delhi suffers from <a href="https://ig.ft.com/india-pollution/">acute problems of high pollution levels</a>.One of the first steps to better understand the problem, is to have continuous monitoring of air quality across the cities. Many organizations have stepped up and setup such sensors that collect air quality data and make it publicly available. <a href="https://openaq.org/">OpenAQ</a> is a platform that collects this data from all public sources and makes it available in an easy to use form.</p>
<blockquote>
<blockquote>
<p>If you are interested in this topic, <a href="http://www.urbanemissions.info/">Urban Emissions</a> has a lot of relevant information and datasets for India.</p>
</blockquote>
</blockquote>
<p>We will take the sensor data for <a href="https://blissair.com/what-is-pm-2-5.htm">PM2.5 concentrations</a> 1 day and map it. The aim is to turn this tabular data info an informative spatial data visualization.</p>
<p>For this exercise, we are using daily average data for Delhi, India for February 15, 2020. This data was downloaded from <a href="https://openaq.org/#/countries?_k=dmlk2k">OpenAQ Data Download</a></p>
<div class="figure">
<img src="images/spatial_data_viz/aq1.png" />

</div>
<p>Open the <code>openaq.csv</code> file in a text editor and examine it. Each row of data contains data from 1 monitoring station. The <code>latitude</code> and <code>longitude</code> column contain the coordinates of the station and the <code>value</code> contains the daily average PM2.5 concentration</p>
<div class="figure">
<img src="images/spatial_data_viz/aq0.png" />

</div>
<p>Tabular data in text files fall into the category of <strong>Delimited Text</strong> files, such as this can be imported in QGIS via <em>Data Source Manager</em>. Click <em>Open Data Source Manager</em> button.</p>
<p><img src="images/spatial_data_viz/aq2.png" /> Browse to the <code>openaq.csv</code> file and open it. As we want to import this file as points, select <em>Point coordinates</em>. Choose <code>longitude</code> as <em>X Field</em> and <code>latitude</code> as <em>Y Field</em>. Click <em>Add</em>.</p>
<p><img src="images/spatial_data_viz/aq3.png" /> You will see the tabular data now loaded in QGIS canvas as a spatial data layer. Use the <em>Identify</em> button and click on any of the point. You will see the attribute data that is attached to each point.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq4.png" />

</div>
<p>Through we can see the point distribution is across the city of Delhi, we are missing the context on where is point is located. A base-map layer will help us understand this data better. The <strong>QuickMapServices</strong> plugin gives us ready access to many different types of base-maps. Go to <strong>Web → QuickMapServices → OSM → OpenStreetMap monochrome</strong> layer.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq5.png" />

</div>
<p>A new layer will get added to the <em>Layers</em> panel and the <em>Canvas</em>. Now you can see the points in the context of the city and surroundings. Let’s style the point layer better now. Click <em>Open the Layer Styling Panel</em>.</p>
<p><img src="images/spatial_data_viz/aq6.png" /> We will color each point according to the observed PM2.5 value. Choose <code>Graduated</code> renderer and <code>value</code> as the <em>Value</em> column. Set the number of <em>Classes</em> to <code>6</code> and click <em>Classify</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq7.png" />

</div>
<p>For the class ranges to have some meaning, we need to link them to the commonly used scale. India has adopted <a href="https://pib.gov.in/newsite/PrintRelease.aspx?relid=110654">National Air Quality Index</a> with the following definitions.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq_naqi.png" alt="Source: The National Air Quality Index, Minister for Environment, Forests &amp; Climate Change, India" />
<p class="caption">Source: The National Air Quality Index, Minister for Environment, Forests &amp; Climate Change, India</p>
</div>
<p>Let’s adjust the class values to match those defined in the National Air Quality Index. We can also change the <em>Legend</em> labels to the human-readable category names. You can double-click each class range and edit it.</p>
<p><img src="images/spatial_data_viz/aq8.png" /> As you edit the categories, the map visualization will change accordingly. The layer legend will also show the legend labels now.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq9.png" />

</div>
<p>We can change the color also to match those defined in the index. Select the dropdown next to the color ramp and select the <code>RdYlGn</code> (Red-Yellow-Green) ramp.</p>
<p><img src="images/spatial_data_viz/aq10.png" /> We want the ramp to go from Green (low PM2.5 values) to Red (high PM2.5 values) - so click the dropdown again and select <em>Invert Color Ramp</em>. <img src="images/spatial_data_viz/aq11.png" /> We will add labels to the points now. Switch to the <em>Labels</em> tab. <img src="images/spatial_data_viz/aq12.png" /></p>
<p>Choose <code>Single labels</code> and <code>value</code> as <em>Value</em>. Scroll down and check <em>Formatted numbers</em> and change the <em>Decimal places</em> to <code>0</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq13.png" />

</div>
<p>Next, switch to the <em>Background</em> tab. Check <em>Draw background</em> and adjust the <em>Size X</em> and <em>Size Y</em>. <img src="images/spatial_data_viz/aq14.png" /> Scroll down to the <em>Fill color</em> section. We want the fill color for each box to match the color of the associated point. Click the <em>Data defined override</em> button and choose <em>Edit</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq15.png" />

</div>
<p>Double-click the <code>@symbol_color</code> variable to add it to the expression. Click OK.</p>
<p><img src="images/spatial_data_viz/aq16.png" /> You will see the map change and the label shields will have the color matching the category based on the values. We will move the labels slightly above so the points are also seen. Switch to the <em>Placement</em> tab and select <em>Offset from point</em>. Check the <em>Offset Y</em> to <code>-5</code>. <img src="images/spatial_data_viz/aq17.png" /> Lastly, go the <em>Callouts</em> tab and check <em>Draw callouts</em> to make it easy to see which labels belong to which point.</p>
<p><img src="images/spatial_data_viz/aq18.png" /> It is a good idea to save out work. Click the <em>Save Project</em> button and save it as <code>air_quality.qgz</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq19.png" />

</div>
<p>You can see most of the labels are legible, but some are too close and feel a bit cluttered. We can fix them by manually adjusting the placement. Right-click anywhere on the toolbar area and enable the <em>Label Toolbar</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq20.png" />

</div>
<p>Click the <em>Move a Label</em> button. Click <em>OK</em> on the <em>Auxiliary Storage</em> prompt.</p>
<p><img src="images/spatial_data_viz/aq21.png" /> With the <em>Move a Label</em> button active, click on a any label to select it. Click at the place you want to move it to, and it will be placed there. Once you are satisfied, save the project. It is time to export our map. Go to <strong>Project → New Print Layout…</strong>. Leave the name empty and click <em>OK</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq22.png" />

</div>
<p>Print Layouts are a way to compose a static map with various elements such as labels, legends, north arrow, scale bar etc. Go to <strong>Add Item → Add Map</strong>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq23.png" />

</div>
<p>Drag a rectangle where you want the map to be rendered. Once you leg go of you your mouse button, the map from the main canvas will be loaded in the region.</p>
<p><img src="images/spatial_data_viz/aq24.png" /> Next, we will add a <em>Rectangle</em> which will hold the tile, legend and attribution.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq25.png" />

</div>
<p>Place the rectangle on the top-right hand corner and change the <em>Corner radius</em> to <code>10</code>.</p>
<p><img src="images/spatial_data_viz/aq26.png" /> Next, add a <em>Label</em> with the title <code>Average PM2.5 Concentration (µg/m3)</code> and date <code>15 Bebruary, 2020</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq27.png" />

</div>
<p>Add another <em>Label</em> with the attribution text <code>Data Source: Central Pollution Control Board, EPA AirNow DOS. Downloaded from OpenAQ.org</code>. Now we will add a legend, so our users know how to interpret various colors on the map. Go to <strong>Add Item → Add Legend</strong></p>
<div class="figure">
<img src="images/spatial_data_viz/aq28.png" />

</div>
<p>Drag a box to insert the legend. Go to the <em>Item Properties</em> tab and turn-off <em>Auto update</em>. Remove the <code>OpenStreetMap monochrome</code> layer and set the <code>openaq</code> group label to <em>Hidden</em>. <img src="images/spatial_data_viz/aq29.png" /></p>
<p>The default legend placement is vertical - in a single column. We can change it to be in multiple columns to make it span horizontal. Scroll down to the <em>Columns</em> section and change the <em>Count</em> to <code>2</code> and check <em>Split layers</em> button.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq30.png" />

</div>
<p>In the <em>Main Properties</em> section, enter a <em>Title</em> for the legend as <code>Air Quality Index Category</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq31.png" />

</div>
<p>Once you are satisfied with the map, we can export the map. You can export the composition as an <strong>Image</strong> if you wanted to use it in a website, email, slideshow etc. You can also export it to as an <strong>SVG</strong> so it can be further edited in a graphics program such as <a href="https://inkscape.org/">InkScape</a>. But the most common format for maps is still a PDF.</p>
<div class="figure">
<img src="images/spatial_data_viz/shp_to_pdf.png" alt="Credit: Atanas Entchev @atanas" />
<p class="caption"><a href="https://twitter.com/atanas/status/1181944494507413504?s=20">Credit: Atanas Entchev @atanas</a></p>
</div>
<p>So let’s export our map to a PDF. Before exporting, switch to the <em>Layout</em> tab and set the <em>Export resolution</em> to <code>100</code> dpi. Go to <strong>Layout → Export as PDF</strong>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq32.png" />

</div>
<p>In the <em>PDF Export Options</em>, you can check <em>Create Geospatial PDF (GeoPDF)</em>. GeoPDF is an enhanced PDF format that is spatially aware and preserves layer and attribute information. Click <em>Save</em> and save the output as <code>delhi_air_quality.pdf</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq33.png" />

</div>
<p>If you open the resulting PDF in a compatible reader such as <a href="https://get.adobe.com/reader/">Adobe Acrobat</a>, you can toggle layer visibility, query attributes by features, measure distances and so on.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq34.png" />

</div>
</div>
</div>
<div id="lines" class="section level2">
<h2>Lines</h2>
<p>Many of our transportation infrastructure such as roads, bridges, railways etc. as well as natural features such as rivers, streams etc. can be modeled as lines. Other abstract concepts, such as contours and trajectories are also modeled using linear features. Shapefiles, GeoJSON, GPX are commonly used file formats for storing line datasets.</p>
<div id="exercise-visualize-gps-tracks" class="section level3">
<h3>Exercise: Visualize GPS Tracks</h3>
<p>GPS tracks have become ubiquitous in modern life. With GPS built-into most phones, many of us capture the tracks while running or biking outdoors. Cab companies use GPS tracks collected during the trip to determine fares. Delivery and logistics companies store and analyze millions of GPS tracks from their assets to derive location intelligence.</p>
<p>We will use a GPS track I collected using the open-source <a href="https://www.basicairdata.eu/projects/android/android-gps-logger/">GPS Logger app</a> while cycling to work. The default format for storing GPS tracks is <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format">GPS Exchange Format (GPX)</a>. It is a XML-based text format that allows storing points, tracks and routes in a single file. We will use the data in <code>sample_gps_track.gpx</code> file and create an animated GIF showing the trip.</p>
<ol style="list-style-type: decimal">
<li>Locate the<code>sample_gps_track.gpx</code> file and drag it to the canvas. As the file contains multiple data types, a pop-up will ask us to select the layers to add. Hold the <em>Shift</em> key and select both <code>track_points</code> and <code>tracks</code> layers. Click <em>OK</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>To add some context to the map, we should add a basemap. A dark background map works best for the visualization we want to create. Go to <strong>Web → QuickMapServices → CartoDB → Dark Matter</strong> layer.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>Select the <code>sample_gps_track tracks</code> layer and click <em>Open the Layer Styling Panel</em>. You can change the line <em>Color</em> to <code>Blue</code> and <em>Width</em> to <code>0.5</code>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>Before styling the points, we will first export the layer to a different format. Animating the points require applying filters on the data layer which doesn’t work well with the GPX format, so we will export it to a GeoPackage. Right-click the <code>sample_gps_tracks track_points</code> layer and go to <strong>Export → Save Feature As</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>Select the output <em>File name</em> as <code>gps_points.gpkg</code>. Make sure the <em>Add saved file to map</em> button is checked and click <em>OK</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>A new layer <code>gps_points</code> will be added to the <em>Layers</em> panel. In the <em>Layer Styling Panel</em>, select <em>Simple marker</em> symbol. Change the point <em>Size</em> to <code>1</code> . Choose a lighter shade of Blue as the <em>Fill color</em> and a <code>Transparent Stroke</code> as <em>Stroke color</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>We want to give a glow effect to the points as it is animating. Right-click the <code>gps_points</code> layer and choose <em>Duplicate Layer</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps7.png" />

</div>
<ol start="8" style="list-style-type: decimal">
<li>In the <em>Layer Styling Panel</em> for the duplicated <code>gps_points_copy</code> layer, choose bright neon as the <em>Color</em> and increase the size to <code>1.5</code>. Check the <em>Draw Effects</em> option and click the <em>Effects</em> button next to it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps8.png" />

</div>
<ol start="9" style="list-style-type: decimal">
<li>In the <em>Effects Properties</em> panel, check <em>Outer Glow</em>. Select <code>2.0</code> for both <em>Spread</em> and <em>Blue radius</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps9.png" />

</div>
<ol start="10" style="list-style-type: decimal">
<li>Now we are ready to animate the points. Go to <strong>Plugins → Time Manager → Toggle visibility</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps10.png" />

</div>
<ol start="11" style="list-style-type: decimal">
<li>In the <em>Time Manager</em> panel, click the <em>Power</em> button to activate the plugin. Click <em>Settings</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps11.png" />

</div>
<ol start="12" style="list-style-type: decimal">
<li>In the <em>Time Manager Settings</em> window, check the <em>Lopping animation</em> button. Next, click the <em>Add layer</em> button.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps12.png" />

</div>
<ol start="13" style="list-style-type: decimal">
<li>To achieve the effect we want, we will animate both <code>gps_points</code> and the <code>gps_points_copy</code> layers. First select <code>gps_points</code> layer. Select <code>time</code> as the <em>Start time</em> and <code>No end time - accumulate features</code> as the <em>End time</em>. Make sure to check the <em>Accumulate features</em> box. Click <em>OK</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps13.png" />

</div>
<ol start="14" style="list-style-type: decimal">
<li>Click <em>Add layer</em> again and this time select <code>gps_points_copy</code> layer. Select <code>time</code> as the <em>Start time</em> and <code>Same as start</code> as the <em>End Time</em>. Uncheck the <em>Accumulate features</em> box.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps14.png" />

</div>
<ol start="15" style="list-style-type: decimal">
<li>Once both the layers are configured, click <em>OK</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps15.png" />

</div>
<ol start="16" style="list-style-type: decimal">
<li>Back in the main QGIS window, change the <em>Time frame size</em> to <code>1 second</code>. Click <em>Play</em>. You will see the points animate and show the position along with the timestamp. You can click <em>Export Video</em> to export individual frames to a folder.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps16.png" />

</div>
<ol start="17" style="list-style-type: decimal">
<li>Once you have the individual frames, you can use a program such as <a href="https://ezgif.com/">ezgif.com</a> to create an animated GIF from them. The result would look as below.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/gps17.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/spatial_data_viz/gps17.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
</div>
<div id="polygons" class="section level2">
<h2>Polygons</h2>
<p>Regions are modeled as polygons. Polygons are most commonly used to model administrative areas, buildings, land parcels etc. Polygon geometry is represented as a series of coordinates. Since the shapes can be complex, polygons have a more verbose geometry descriptions and seldom come in a CSV files. GeoJSON and shapefile are the most commonly used file formats for storing polygon datasets.</p>
<div id="exercise-mapping-census-data" class="section level3">
<h3>Exercise: Mapping Census Data</h3>
<p>Census data is one of the major sources of secondary data available in a country. Many types of spatial analysis requires detailed demographic information that is available from the census data.</p>
<p>Census data is usually published as tables by aggregating the raw numbers to an administrative region - typically a <em>census block</em>. To map these tables, one needs to know the <em>goemetry</em> of these regions - which are supplied separately as boundary files. Both of these can be joined to create a polygon layer that can be visualized and mapped. See <a href="https://www.qgistutorials.com/en/docs/3/performing_table_joins.html">this tutorial</a> on how this process is carried out in QGIS.</p>
<p>We will use <a href="https://sedac.ciesin.columbia.edu/data/set/india-india-village-level-geospatial-socio-econ-1991-2001">India Village-Level Geospatial Socio-Economic Data Set</a> published by NASA Socioeconomic Data and Applications Center (SEDAC). This dataset combines the village/town level boundaries with Primary Census Abstract (PCA) and Village Directory (VD) data series of the Indian census. It is distributed as shapefiles.</p>
<p>For this exercise, we will be using the shapefile for the state of Karnataka and map the literacy rate in the Gulbarga district.</p>
<p>Locate the <code>india-village-census-2001-KA.shp</code> file in the <em>Browser</em> panel and drag it to QGIS canvas.</p>
<div class="figure">
<img src="images/spatial_data_viz/census1.png" />

</div>
<p>A new layer <code>india-village-census-2001-KA</code> will be added to the <em>Layers</em> panel. Use the <em>Identify</em> tool to click on any polygon are explore the attributes. The definitions of each column is contained in the documentation that is supplied with the data. As we are looking to map the literacy levels, the attributes with <code>_LIT</code> suffix are useful for our purpose. The <code>P_LIT</code> column refers to <em>Person Literates</em> and <code>TOT_P</code> refers to <em>Total Population</em> that we will use to calculate and map literacy rate.</p>
<div class="figure">
<img src="images/spatial_data_viz/census2.png" />

</div>
<p>We want to select a subset of polygons from this layer belonging to the <em>Gulbarga</em> district. Load the <code>gulbarga_district.shp</code> layer that has been extracted from the Districts shapefile supplied by DataMeet. The column <code>DT_CEN_CD</code> contains the district id for this particular district. We can use this to filter the polygon layer.</p>
<div class="figure">
<img src="images/spatial_data_viz/census3.png" />

</div>
<p>In the <em>Layers</em> panel, drag the <code>gulbarga_district</code> layer below the <code>india-village-census-2001-KA</code> layer. Right-click the <code>india-village-census-2001-KA</code> layer and select <em>Filter</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/census4.png" />

</div>
<p>Enter the expression <code>DISTRICT = 4</code> to select all villages and towns from our chosen district. Click <em>OK</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/census5.png" />

</div>
<p>You will see a filter icon next to the <code>india-village-census-2001-KA</code> layer indicating that a filter is applied to the layer. The map canvas will update to show only the polygons belonging to the district.</p>
<div class="figure">
<img src="images/spatial_data_viz/census6.png" />

</div>
<p>Now we will create a <em>thematic</em> map showing the literacy rate in the district. When creating a thematic (choropleth) map such as this, it is important to normalize the values you are mapping. A common mistake is to use totals instead of rates in such map.</p>
<div class="figure">
<img src="images/spatial_data_viz/totals_vs_rates.png" alt="Credit: Kenneth Field @kennethfield" />
<p class="caption"><a href="https://twitter.com/kennethfield/status/1226918404587585549?s=20">Credit: Kenneth Field @kennethfield</a></p>
</div>
<p>Click <em>Open the Layer Styling Panel</em>. Select <em>Graduated</em> renderer. In the <em>Value</em> column, click the <em>Expression</em> button.</p>
<div class="figure">
<img src="images/spatial_data_viz/census7.png" />

</div>
<p>Enter the following expression. As we want to map literacy rate, we can normalize the total literate persons by dividing with the total population.</p>
<pre><code>100*(&quot;P_LIT&quot;/&quot;TOT_P&quot;)</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/census8.png" />

</div>
<p>Choose a color ramp and the <em>Mode</em> of your choice and click <em>Classify</em>. You will see the polygons colored according to the literacy rates. Mapping this makes is much easier to see the pattern that villages to the south of the district have much lower literacy rates than their northern counterparts.</p>
<div class="figure">
<img src="images/spatial_data_viz/census9.png" />

</div>
<p>If you zoom in - you will notice gaps in the polygon layer. These are the areas with cities which do not have Village Directory (VD) data tables and thus excluded in this data layer. Instead of a hole, we can style is better to indicate no-data values. Select the <code>gulbarga_district</code> layer. Change the <em>Symbol layer type</em> to be <code>Line pattern fill</code>. Change the spacing as per your liking.</p>
<div class="figure">
<img src="images/spatial_data_viz/census10.png" />

</div>
<p>You will notice that the options for fill do not have a cross pattern fill. That is because it can be easily created by combining 2 line pattern fills of opposite direction. Click the <em>Duplicate the current layer</em> button in the <em>Layer Styling Panel</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/census11.png" />

</div>
<p>Change the <em>Rotation</em> value to <code>-45.00</code> degrees. You will see the gaps now rendered with a cross-pattern fill.</p>
<div class="figure">
<img src="images/spatial_data_viz/census12.png" />

</div>
<p>You have a visualization of the literacy rate in the district.</p>
<div class="figure">
<img src="images/spatial_data_viz/census13.png" />

</div>
</div>
</div>
<div id="point-clouds" class="section level2">
<h2>Point Clouds</h2>
<p>Modern mapping technology includes doing aerial surveys using a LiDAR sensor. LiDAR stands for “Light Detection and Ranging”. This sensor uses light pulses to determine the distance to the objects of the ground. For each light-pulse that is sent out the system computes X,Y and Z coordinates of the object. This data representation is not new for spatial data - but since survey of even a small area can result in millions of such points - standard tools for viewing and processing points do not work. Such a <em>Point Cloud</em> is typically stored in the LAS or LAZ formats.</p>
<div class="figure">
<img src="images/spatial_data_viz/lidar.jpg" alt="Photo Cargyrak, CC BY-SA 4.0" />
<p class="caption">Photo <a href="https://commons.wikimedia.org/w/index.php?curid=48685015">Cargyrak</a>, CC BY-SA 4.0</p>
</div>
<div id="exercise-view-point-cloud-from-an-aerial-survey" class="section level3">
<h3>Exercise: View Point Cloud from an Aerial Survey</h3>
<p>UK’s Department of Environment Food &amp; Rural Affairs (DEFRA) provides country-wide LiDAR data and products via the <a href="https://environment.data.gov.uk/">Defra Data Services Platform</a> under an open license. We will use a point cloud dataset for Oxford University available as a LAZ file.</p>
<p><a href="https://github.com/verma/plasio">Plasio</a> is a browser-based LAS/LAZ point cloud viewer. Visit <a href="https://plas.io/">plas.io</a>. Click <em>Browse</em> and locate the <code>point_cloud_oxford.laz</code> file. Click <em>Open</em>. Note that this small region is rendered with over 3.5M source points.</p>
<div class="figure">
<img src="images/spatial_data_viz/pointcloud1.png" />

</div>
<p>Once the data is loaded, scroll down in the right-hand panel and locate the <em>Intensity Source</em> section. Select <code>Heightmap Grayscale</code> option from the drop-down selector.</p>
<div class="figure">
<img src="images/spatial_data_viz/pointcloud2.png" />

</div>
<p>Use the left-mouse button and scroll-wheel to zoom/pan around and explore the dataset.</p>
<div class="figure">
<img src="images/spatial_data_viz/pointcloud3.png" />

</div>
</div>
</div>
<div id="raster---photos" class="section level2">
<h2>Raster - Photos</h2>
<p>Photos collected from airborne sensors - such as kites, hot-air balloons, planes, helicopters and more recently UAVs - are useful source of information for mapping. They often act as a basemap - providing context for other spatial data. They are also used to extract feature information that are modeled as vector data.</p>
<p>The most common format for imagery is GeoTiff. A geotiff file contains additional metadata that allow us to convert pixel location (row/column) to a real-world location (latitude/longitude). A regular photo can be converted to a spatially-aware raster through a process known as <a href="https://en.wikipedia.org/wiki/Georeferencing">GeoReferencing</a>.</p>
<div id="exercise-view-drone-imagery" class="section level3">
<h3>Exercise: View Drone Imagery</h3>
<p><a href="https://openaerialmap.org/">OpenAerialMap</a> is an open service to share and download overhead imagery. We will use an image of Kathmandu University Grounds shared by WeRobotics.</p>
<p>Browse to the <code>kathmandu_drone_imagery.tif</code> file and drag it to QGIS. Use the Zoom/Pan tools to explore the imagery.</p>
<div class="figure">
<img src="images/spatial_data_viz/drone1.png" />

</div>
<p>At the bottom right, notice that the CRS is EPSG:32645 which refers to the UTM Zone 45N. Select the <em>Identify</em> tool and click anywhere on the image. You will see that the image contains 3 bands - one each for Red, Green and Blue. The coordinates are projected coordinates - not geographic coordinates. These are referred as <em>X (Easting)</em> and <em>Y (Northing)</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/drone2.png" />

</div>
<p>As the image is also georeferenced, we can see it in context of other spatial layers. Go to <strong>Web → QuickMapServices → OSM → OSM Standard</strong>. A tile layer will be added to the <em>Layers</em> panel and you can see both line up with each other since both layers are spatially aware.</p>
<div class="figure">
<img src="images/spatial_data_viz/drone3.png" />

</div>
</div>
</div>
<div id="raster---satellite-images" class="section level2">
<h2>Raster - Satellite Images</h2>
<p>There are hundreds of Earth Observation Satellites in space continuously capturing images of the earth. Many space agencies around the world make this data available freely. These datasets are immensely valuable to scientists, researchers, governments and businesses.</p>
<p>The satellite images are different than regular photos because they contain information in across many bands of wavelengths - not just - Red, Green and Blue. This rich information allows machine learning models to easily distinguish different objects. For example, an astroturf and real lawn may both look green, but reflect the infrared light very differently. So one can easily differentiate between these using the additional information contained in a multi-spectral image.</p>
<div id="exercise-view-sentinel-2-image-and-create-composites" class="section level3">
<h3>Exercise: View Sentinel-2 Image and Create Composites</h3>
<p><a href="https://sentinel.esa.int/web/sentinel/missions/sentinel-2">Sentinel-2</a> is a European Space Agency (ESA) mission with 2 satellites. The resolution of each pixel in the image is 10 meters. This is lower than drone or aerial imagery resolution, but still good enough for city and region level analysis. More importantly, the data is captured in 12 different bands - making it very useful for scientific applications. These mission capture every location on the earth every 5 days, allowing for continuous monitoring of the whole each. ESA also makes all the data from this mission freely available.</p>
<p>We will load a Sentinel-2 image for Bangalore, India captured on 18 February, 2020. The data package directory <code>imagery/sentinel-2</code> 4 files in JPEG2000 format. The 4 files are for bands Red (B4), Green (B3), Blue (B2) and Near Infrared (B8).</p>
<p>Drag all 4 images to the QGIS canvas. Zoom in to any area and explore how the same object has different reflectance in different bands.</p>
<div class="figure">
<img src="images/spatial_data_viz/satellite1.png" />

</div>
<p>We can combine multiple bands into a single image and visualize it. These are called <em>Color Composites</em>. To merge individual images to a single one, go to <strong>Processing → Toolbox</strong> and find <strong>GDAL → Raster miscellaneous → Build virtual raster</strong>. Double-click to launch the tool.</p>
<p>Select all 4 layers as <em>Input layers</em> and check <em>Place each input file into a separate band</em>. Next click <em>Run</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/satellite3.png" />

</div>
<p>A new layer <code>Virtual</code> will be added to the <em>Layers</em> panel. This layer contains references to the 4 different images. Note that the order of the bands in alphabetical, so the mapping in the virtual raster is as follows:</p>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Virtual Raster Band</strong></th>
<th align="left"><strong>Image</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Band 1</td>
<td align="left">B02 (Blue)</td>
</tr>
<tr class="even">
<td align="left">Band 2</td>
<td align="left">B03 (Green)</td>
</tr>
<tr class="odd">
<td align="left">Band 3</td>
<td align="left">B04 (Red)</td>
</tr>
<tr class="even">
<td align="left">Band 4</td>
<td align="left">B08 (NIR)</td>
</tr>
</tbody>
</table>
<p>We will first visualize a <em>RGB Color Composite</em>. This is also referred as a <em>Natural Color Composite</em> since it is how the image would be perceived by the human eye. Place <code>Band 3</code>, <code>Band 2</code> and <code>Band 1</code> as <em>Red</em>, <em>Green</em> and <em>Blue</em> bands. Change the <em>Min/Max Value Settings</em> to <code>Cumulative count cut</code>. You will see the image now appears in natural colors.</p>
<div class="figure">
<img src="images/spatial_data_viz/satellite4.png" />

</div>
<p>Let’s create a different type of visualization, known as <em>False Color Composite</em>. Here we want to create a <em>NRG Color Composite</em> where we put Near Infrared band in Red channel, Red band in green channel and Green band in blue channel. This visualization highlights the vegetation in red color and allows for easy visual interpretation of vegetation. Note how the water body and vegetation appeared almost the same color in the RGB composite, but are easy to separate in the NRG composite.</p>
<div class="figure">
<img src="images/spatial_data_viz/satellite5.png" />

</div>
</div>
</div>
<div id="raster---elevation-data" class="section level2">
<h2>Raster - Elevation Data</h2>
<p>Raster data is well suited for modeling continuous phenomena, such as elevation. Each pixel of the raster is assigned the height as the value. This is a simple but effective way to model the terrain. Such raster are known as a Digital Elevation Model (DEM).</p>
<p>Digital Elevation Models fall into 2 broad categories</p>
<ul>
<li>Digital Surface Model (DSM): A DSM represents the true surface of the earth, including tree canopy, buildings etc.</li>
<li>Digital Terrain Model (DTM): A DSM represents the bare ground and natural terrain. A DTM is usually created by algorithmic or manual processing of a DSM.</li>
</ul>
<div id="exercise-view-and-compare-dsmdtm" class="section level3">
<h3>Exercise: View and compare DSM/DTM</h3>
<p>UK’s Department of Environment Food &amp; Rural Affairs (DEFRA) provides country-wide elevation data products via the <a href="https://environment.data.gov.uk/">Defra Data Services Platform</a> under an open license. We will use DSM and DTM dataset for Oxford University available as a ASC files, <code>dsm_F0195499_20161130_20161130_mm_units.asc</code> and <code>dtm_F0195499_20161130_20161130_mm_units.asc</code></p>
<p>The <code>.asc</code> file is in the text-based ASCII Raster File Format. It is a simple data format that contains a header with information about the raster and pixel values as rows/columns. If you open any of the files in a text editor, it will appear as below:</p>
<pre><code>cols          2000
nrows         2000
xllcorner     450000
yllcorner     208000
cellsize      1
NODATA_value  -9999
-9999 -9999 -9999 -9999 -9999 -9999 ...
...
...</code></pre>
<p>The header contains the X and Y coordinates of lower-left (ll) corner of the image. Knowing this 1 coordinate pair, the size of the image and the Coordinate Reference System (CRS) will allow us to geo-reference the entire image. The information about the CRS is contained in the <a href="https://ckan.publishing.service.gov.uk/harvest/object/2533c88a-ccf2-41d7-8ac7-704c46bfd177/html">metadata</a> and is specified as <em>EPSG:27700 British National Grid</em>. We now have enough information to view these rasters.</p>
<ol style="list-style-type: decimal">
<li>Open QGIS. Before we load the data, we should set our project CRS to the CRS of the rasters. Go to <strong>Project → Properties</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Switch to the <em>CRS</em> tab and search for <code>EPSG:27700</code> and select it. Click <em>OK</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>Locate the <code>dsm_F0195499_20161130_20161130_mm_units.asc</code> file and drag it to the canvas. Select <em>Identify</em> and click anywhere on the image. You will see that the <em>Band 1</em> of the image contains the elevation of the pixel in millimeters.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>Click <em>Open the Layer Styling Panel</em>. Select <code>Singleband pseudocolor</code> renderer. Expand the <em>Min / Max Value Settings</em> section and select <em>Cumulate count cut</em>. Select a color ramp of your choice. Once styles you will be able to see the building outlines, trees, riverbed etc clearly.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>Next locate the <code>dtm_F0195499_20161130_20161130_mm_units.asc</code> file and drag it to the canvas. To enable easy comparison between the 2 layers, we should visualize them with the same parameters. Fortunately QGIS provides and easy way to copy/paste styles between layers. Right-click the <code>dsm_F0195499_20161130_20161130_mm_units</code> layer and go to <strong>Styles → Copy Style</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>Next, select the <code>dtm_F0195499_20161130_20161130_mm_units</code> layer, right-click and go to <strong>Styles → Paste Style</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>Toggle the visibility of the top layer and compare both the DSM and the DTM. You will see the DTM contains only the underlying terrain with all natural and man-made features removed.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/elevation7.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/spatial_data_viz/elevation7.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
</div>
</div>
<div id="analysis" class="section level1">
<h1>Analysis</h1>
<div id="exercise-uber-movement-analysis" class="section level2">
<h2>Exercise: Uber Movement Analysis</h2>
<p><a href="https://movement.uber.com/">Uber</a> provides anonymized data aggregated from over ten billion taxi trips to help urban planning around the world. The data is freely available in open-format for download. The dataset includes info such as travel times and speeds along each road segment.</p>
<p>We will take the <a href="https://movement.uber.com/explore/bangalore/travel-times/query?lang=hi-IN">Travel Times data</a> for the city of Bangalore to analyze the traffic patterns and find out the areas that are accessible within 30 minutes of driving. This type of map is known as an <a href="https://en.wikipedia.org/wiki/Isochrone_map">Isochrone Map</a> and is useful in urban planning.</p>
<p>The data comes in 2 parts. A GeoJSON file <code>bangalore_wards.json</code> depicting the boundaries of wards in the city and a CSV file <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate.csv</code> that contains travel times aggregated at the ward level and hour of the day for the time period Q3 (July-Sep) of 2019. <a href="https://d3i4yxtzktqr9n.cloudfront.net/web-movement/76002ded222a46a02ae89f207e91e335.pdf">A whitepaper</a> documents the methodology used for creating this dataset.</p>
<p>The structure of the CSV file is as follows</p>
<table>
<thead>
<tr class="header">
<th align="left"><strong>sourceid</strong></th>
<th align="left"><strong>dstid</strong></th>
<th align="left"><strong>hod</strong></th>
<th align="left"><strong>mean_travel_time</strong></th>
<th align="left">…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">55</td>
<td align="left">111</td>
<td align="left">8</td>
<td align="left">2026.76</td>
<td align="left">…</td>
</tr>
<tr class="even">
<td align="left">22</td>
<td align="left">25</td>
<td align="left">13</td>
<td align="left">770.07</td>
<td align="left">…</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">…</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>sourceid</strong> and <strong>dstid</strong>: the pair of origin-destination ward ids</li>
<li><strong>hod</strong>: hour-of-day. Ranges from 0-23</li>
<li><strong>mean_travel_time</strong>: average travel time in seconds aggregated from all the trips</li>
</ul>
<p>There are 198 wards in Bangalore. The file contains pair-wise travel time between each of them for all hours of the day. The total records of travel times between them would be 198 x 198 x 24 = 940896. But since not all wards have enough trips between them at certain hours, they are not provided. Thus our file contains a total of 818263 rows. This is still a lot of data and we need to do some Analysis to extract the right set from it.</p>
<ol style="list-style-type: decimal">
<li>Let’s first load a base layer from OpenStreetMap. Go to <strong>Web → QuickMapServices → OSM → OSM Standard</strong>. Next locate the <code>bangalore_wards.json</code> file in the <em>Browser</em> panel and drag it to the canvas. Once loaded, click <em>Open Data Source Manager</em> button.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Switch to the <em>Delimited Text</em> tab. Browse to the <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate.csv</code> file and select it. Since this CSV file is just tabular data, select <em>No geometry (attribute only table)</em> option and click <em>Add</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>Once the <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate</code> layer is added to the <em>Layers</em> panel, right-click on it and select <em>Show Feature Count</em>. The total rows from the table will be displayed next to it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>For the purpose of this exercise, we will calculate all areas that are accessible within 30 minutes from <a href="https://g.page/spatialthoughts?share">Spatial Thoughts office</a>. When you find the area on the basemap, you can select the <em>Identify</em> button and select <code>bangalore_wards</code> layer and click on it. The results will confirm that the office is located in the <em>JP Nagar</em> ward with the <em>MOVEMENT_ID</em> <strong>193</strong>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>We can filter the travel time records to just those which have this ward as the destination. We can also restrict our analysis to the peak morning commute hours of 9am-10am. Right-click the <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate</code> layer and select <em>Filter</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>Enter the following filter expression and click <em>OK</em>.</li>
</ol>
<pre><code>&quot;dstid&quot; = 193 AND &quot;hod&quot; = 9</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/uber6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>Back in the main QGIS window, you will see that the number of records in the filtered table are now down to just <em>197</em>. Since there are a total of 198 wards in the city, we have records of travel times between the 1 destination ward and 197 source wards. Open the attribute table of both the layers using the <em>Open Attribute Table</em> button in the <em>Attributes</em> toolbar.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber7.png" />

</div>
<ol start="8" style="list-style-type: decimal">
<li>Now we have the shapes of the ward in the layer <code>bangalore_wards</code> and tabular information in the layer <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate</code>. We can join the attribute information to the shapes using a common attribute. Here the <strong>MOVEMENT_ID</strong> column from the <code>bangalore_wards</code> layer and <strong>sourceid</strong> column from the <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate</code> are unique ward identifiers that can be joined. This operation is called a <em>Table Join</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber8.png" />

</div>
<ol start="9" style="list-style-type: decimal">
<li>Before we can join these two layers, we must ensure that the values in both columns match exactly. Thought they appear the same, they are of different type. Since GeoJSON format has no way of specifying property types, all values are assumed to be of the type <em>String</em> - i.e. Text. But when we import a CSV to QGIS, QGIS intelligently determines the types of the columns based on the values and hence has assigned the type <em>Integer</em> to the column <strong>sourceid</strong>. So we need to convert the column from the GeoJSON to an integer type as well. Go to <strong>Processing → Toolbox</strong>. Search for the <em>Vector Table → Field Calculator</em> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber9.png" />

</div>
<ol start="10" style="list-style-type: decimal">
<li>Choose <code>bangalore_wards</code> as the <em>Input Layer</em>. Click the <em>…</em> button next to the <em>Output file</em> and name the output as <code>bangalore_wards_fixed.gpkg</code>. Name the new field as <code>joinfield</code> and select the <em>Output field type</em> as <code>Integer</code>. Enter <code>&quot;MOVEMENT_ID&quot;</code> as the expression and click <em>OK</em>. Close the field calculator.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber10.png" />

</div>
<ol start="11" style="list-style-type: decimal">
<li>A new layer <code>bangalore_wards_fixed</code> will be added to the <em>Layers</em> panel. Now we are ready to perform the join. Search for and locate the <em>Join attributes by field value</em> algorithm from the Processing Toolbox.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber11.png" />

</div>
<ol start="12" style="list-style-type: decimal">
<li>Select <code>bangalore_wards_fixed</code> as the <em>Input layer</em> and <code>joinfield</code> as the <em>Table field</em>. Select <code>bangalore-wards-2019-3-OnlyWeekdays-HourlyAggregate</code> as the <em>Input layer 2</em> and <code>sourceid</code> as the <em>Table field 2</em>. Name the <em>Joined layer</em> as <code>uber_travel_times.gpkg</code> and click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber12.png" />

</div>
<ol start="13" style="list-style-type: decimal">
<li>A new layer <code>uber_travel_times</code> will be added to the <em>Layers</em> panel. Let’s style it to visualize the result of the join. Click <em>Open the Layer Styling Panel</em>. Select the <code>Graduated</code> renderer and <code>mean_travel_time</code> as the <em>Value</em>. Select a color ramp and click <em>Classify</em>. You will see the map showing increasing travel times further you go from the destination.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber13.png" />

</div>
<ol start="14" style="list-style-type: decimal">
<li>But we are looking to analyze and extract areas that are within 30 minutes of travel time, so we need to do some more processing. Switch the styling back to the <em>Single symbol</em> renderer. Right-click the <code>uber_travel_times</code> layer and select <em>Filter</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber14.png" />

</div>
<ol start="15" style="list-style-type: decimal">
<li>Enter the following expression to select all wards within 1800 seconds (30 minutes) of mean travel time. We also need to include our destination ward which will have 0 travel time.</li>
</ol>
<pre><code>&quot;mean_travel_time&quot; &lt;= 1800 OR &quot;MOVEMENT_ID&quot; = 193</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/uber15.png" />

</div>
<ol start="16" style="list-style-type: decimal">
<li>The layer will now show the cluster of polygons that constitute the area of interest. We will merge all of them to a single polygon now. Search and locate the <em>Dissolve</em> algorithm from the Processing Toolbox.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber16.png" />

</div>
<ol start="17" style="list-style-type: decimal">
<li>Select <code>uber_travel_times</code> as the <em>Input layer</em>. Name the <em>Dissolved</em> layer as <code>30min_isochrone.gpkg</code>. Click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber17.png" />

</div>
<ol start="18" style="list-style-type: decimal">
<li>A new layer <code>30min_isochrone</code> will be added to the <em>Layers</em> panel showing the result of our analysis.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/uber18.png" />

</div>
</div>
<div id="exercise-analyze-metro-rail-accesiblity" class="section level2">
<h2>Exercise: Analyze Metro Rail Accesiblity</h2>
<p>When planning urban infrastructure, a useful criteria is accessiblity to public transport. This excellent article by <a href="https://www.livemint.com/news/india/india-s-public-transport-challenge-1568355574941.html">LiveMint</a> analyzes the metro rail accessibility for cities across India. We will try to do a similar analysis.</p>
<p>In this analysis, we will determine what percentage of population in Bangalore live within 1km of a metro station. The power of GIS lies in combining information from multiple disparate sources to answer questions. To carry out this analysis, we will first query OpenStreetMap database to get the location of functioning metro stations in Bangalore. Then we calculate a 1km buffer and combine it with a population grid from WorldPop to determine the population statistics.</p>
<ol style="list-style-type: decimal">
<li>Locate the <code>bangalore.geojson</code> file and drag it to the canvas. This polygon layer represents the city boundary.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Now we will query OpenStreetMap to get a vector layer of railway stations in the city. Go to <strong>Vector → QuickOSM → QuickOSM</strong>. OpenStreetMap uses a tagging system to record properties of physical features. The tags and the key/value pairs are described in <a href="https://wiki.openstreetmap.org/wiki/Map_Features">OpenStreetMap wiki</a>. To railway stations are tagged with <code>railway=station</code>. Enter <code>railway</code> as the <em>Key</em>, <code>station</code> as the <em>Value</em> and <em>Bangalore</em> as the geographic filter <em>In</em>. Expand the <em>Advanced</em> section and check only the <em>Node</em> and <em>Points</em> boxes. Click <em>Run Query</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>Once the query finishes, you will see a new layer <code>railway_station_Bangalore</code> loaded in the canvas. This includes all railway stations - including the ones operator by Indian Railways and stations under constructions. We can apply a filter to select only the operation metro stations. Right-click the layer and select <em>Filter</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>In the <em>Query Builder</em> enter the following expression and click <em>OK</em>.</li>
</ol>
<pre><code>&quot;operator&quot; = &#39;BMRCL&#39; AND &quot;disused&quot; != &#39;yes&#39; AND &quot;disused:railway&quot; != &#39;station&#39;</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/pop4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>Now the map will update to show only the operation metro stations in the city. Next, we need to apply a <em>Buffer</em> to these stations to find areas within 1km. But our data comes in the EPSG:4326 WGS84 Gepgraphic Projection - which has degrees as units. To do geoprocessing operations on this layer in projected units such as kilometers, we must first reproject the layer in a suitable projected coordinate reference system (CRS). Go to <strong>Processing → Toolbox</strong>. Search for and locate the <strong>Vector general → Reproject layer</strong> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>Choose <code>railway_station_Bangalore</code> as the <em>Input layer</em>. Select <code>EPSG:32643 - WGS 84 UTM Zone 43N</code> as the <em>Target CRS</em>. Name the <em>Reprojected</em> layer as <code>metro_stations_reprojected.gpkg</code>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>Once the reprojected layer <code>metro_stations_reprojected</code> is created, search for the <strong>Vector geometry → Buffer</strong> algorithm and double-click to launch the algorithm.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop7.png" />

</div>
<ol start="8" style="list-style-type: decimal">
<li>Select <code>metro_stations_reprojected</code> as the <em>Input layer</em>. Enter <code>1 kilometers</code> as the <em>Distance</em>. Check the <em>Dissolve result</em> option and name the <em>Buffered</em> output layer as <code>metro_stations_buffer.gpkg</code>. click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop8.png" />

</div>
<ol start="9" style="list-style-type: decimal">
<li>The layer now has a polygon representing areas within 1km of a metro station. Now that we are done with the geoprocessing operation, let’s convert the result back to the original projection so we can use it along with other layers. Search for <strong>Vector general → Reproject layer</strong> algorithm and launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop9.png" />

</div>
<ol start="10" style="list-style-type: decimal">
<li>Select <code>metro_stations_buffer</code> as the <em>Input layer</em> and <code>EPSG:4326 -WGS 84</code> as the <em>Target CRS</em>. Name the output as <code>metro_station_buffer_reprojected.gpkg</code>. Click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop10.png" />

</div>
<ol start="11" style="list-style-type: decimal">
<li>A new layer <code>metro_station_buffer_reprojected</code> will be added to the canvas tha represents the area within 1 km of a metro station. We already have the <code>bangalore</code> layer representing the extent of the city. Now we are ready to extract the population data for both these layers.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop11.png" />

</div>
<ol start="12" style="list-style-type: decimal">
<li>Locate the <code>ind_ppp_2000_KA.tif</code> in the <em>Browser</em> panel. Drag it to the canvas.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop12.png" />

</div>
<ol start="13" style="list-style-type: decimal">
<li>Select the <code>ind_ppp_2000_KA</code> layer and use the <em>Identify</em> tool to explore the pixel values. The resolution of the raster is roughly 100m x 100m. The raster layer has only 1 band and the pixel value is the estimated number of people within the 100 sq. m. area.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop13.png" />

</div>
<ol start="14" style="list-style-type: decimal">
<li>We can determine the total population by summing up the values from the pixels that fall within a polygon. This operation is known as <em>Zonal Statistics</em>. Search for and locate the <strong>Raster analysis → Zonal statistics</strong> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop14.png" />

</div>
<ol start="15" style="list-style-type: decimal">
<li>Select <code>ind_ppp_2000_KA</code> as the <em>Raster layer</em> and <code>bangalore</code> as the <em>Vector layer containing zones</em>. Enter <code>population_</code> as the <em>Output column prefix</em>. We are interested only in the <code>Sum</code> so uncheck other <em>Statistics to calculate</em>. Click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop15.png" />

</div>
<ol start="16" style="list-style-type: decimal">
<li>Once the algorithm finishes, repeat the same process for the <code>metro_station_buffer_reprojected</code> layer.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop16.png" />

</div>
<ol start="17" style="list-style-type: decimal">
<li>This algorithm would add a new attribute to each of these layers with the total population contained within the polygons. Use the <em>Identify</em> tool and click on the polygons. The <strong>population_sum</strong> field will contain the population. You can right-click on it and select <em>Copy Attribute Value</em></li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop17.png" />

</div>
<ol start="18" style="list-style-type: decimal">
<li>QGIS has a built-in calculator. Click on the <em>Locator</em> box at the bottom-left of the window and type <code>=</code>. Paste the population totals from the metro station buffer and the city polygon. The result is the percentage of population that lives within 1km of a metro station.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/pop18.png" />

</div>
</div>
<div id="exercise-distribution-of-green-spaces" class="section level2">
<h2>Exercise: Distribution of Green Spaces</h2>
<p>Open spaces like parks are a critical necessity in dense urban areas. Notonly they help the environment and providing recreational facilities, but as <a href="https://www.google.com/earth/outreach/success-stories/public-health-foundation-of-india/">this study</a> by Public Health Foundation of India (PHFI) found - proximity to a park can also have a positive impact on one’s mental health.</p>
<p>In this exercise, we will take a List of Parks published by Bruhat Bengaluru Mahanagara Palike (BBMP), calculate the total area of parks for each ward of the city and map the results. This data is made available by <a href="http://opencity.in">OpenCity - Urban Data Portal</a> as a PDF file. I converted this PDF to an Excel file using <a href="https://www.zamzar.com/convert/pdf-to-xls/">Zamzar Online file conversion</a> tool. The resulting file was cleaned up and is available as <code>BBMP_Parks.xlsx</code>.</p>
<blockquote>
<blockquote>
<p>This exercise tackles only the total area of park per ward. But quality also matters. Do take a look at the <a href="https://www.ichangemycity.com/pdf/parks-playgrounds-survey-report.pdf">Parks and Playgrounds Score of Bengaluru Report</a> by ichangemycity that did a comprehensive analysis of open spaces in the city.</p>
</blockquote>
</blockquote>
<ol style="list-style-type: decimal">
<li>locate the <code>bangalore_wards.json</code> file in the <em>Browser</em> panel and drag it to the canvas. Next find the <code>BBMP_Parks.xlsx</code> file. QGIS can read Excel files directly too. Drag it to the canvas. You will have 2 layers <code>bangalore_wards</code> and <code>BBMP_Parks_Area</code> loaded in the <em>Layers</em> panel.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Select the <code>BBMP_Parks_Area</code> layer and click <em>Open Attribute Table</em>. The table contains 900+ rows with each row describing a park and its area in sq. meters. We don’t have the exact location of the park, but we know which ward it belongs to.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>We can group all the parks by ward and calculate total park area by each ward. Open the <em>Processing Toolbox</em> and seach for the <strong>Vector analysis → Statistics by categories</strong> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>Select <code>BBMP_Parks_Area</code> as the <em>Input vector layer</em>. Select <code>Area</code> as the <em>Field to calculate statistics on</em>. As we want to group by wards, select <code>Ward</code> as the <em>Field(s) with categories</em>. Name the resulting <em>Statistics by category</em> layer as <code>park_area_by_ward.gpkg</code>. Click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>Now we have a table with the <em>sum</em> of area for each ward allowing us to join it with a spatial layer. Search for and locate the <em>Join attributes by field value</em> algorithm from the Processing Toolbox. Select <code>bangalore_wards</code> as the <em>Input layer</em> and <code>WARD_NO</code> as the <em>Table field</em>. Select <code>park_area_by_ward</code> as the <em>Input layer 2</em> and <code>Ward</code> as the <em>Table field 2</em>. The <code>park_area_by_ward</code> contains many columns with different statistics but we are only interested in <em>sum</em>. So select <code>sum</code> as the <em>Layer 2 fields to copy</em>. Name the output layer as <code>bangalore_wards_park_area_joined.gpkg</code> and click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>A new layer <code>bangalore_wards_park_area_joined</code> will be added to the <em>Layers</em> panel. Before we finalize the results, we can rename the columns to be more descriptive. Search for and locate the <strong>Vector table → Refactor fields</strong> algorithm.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>Select un-wanted columns and use the <em>Delete field</em> to remove them. For the <em>sum</em> column, enter <code>PARK_AREA</code> as the <em>Field name</em>. Name the <em>Refactored</em> output as <code>bangalore_wards_park_area.gpkg</code> and click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park7.png" />

</div>
<ol start="8" style="list-style-type: decimal">
<li>The resulting layer <code>bangalore_wards_park_area</code> will be added to the <em>Layers</em> panel. Explore the attribute table to know the total park area for each ward.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/park8.png" />

</div>
</div>
<div id="exercise-determine-the-best-area-for-a-home" class="section level2">
<h2>Exercise: Determine the Best Area for a Home</h2>
<p>Finding optimal locations is a widely used spatial analytic technique. Using a suitability models, we can combine multiple criteria and detemine rank sites. Here we will take a realistic scenario of determining the best place to live in a city using multiple criteria.</p>
<p>The criteria for this exercise is to rank the wards according to the following criteria</p>
<ul>
<li>Must be within 30-minute driving distance from work. We will consider <a href="https://g.page/spatialthoughts?share">Spatial Thoughts office</a> as the work location.</li>
<li>Must be within 1km of a metro station.</li>
<li>Accessiblity to parks. Wards with more parks are preferred.</li>
</ul>
<p>We already have the data prepped from the previous exercises.</p>
<ul>
<li><code>30min_isochrone.gpkg</code> layer representing areas within 30-minute driving distance from work.</li>
<li><code>metro_station_buffer_reprojected.gpkg</code> layer representing all areas within 1km of a metro station.</li>
<li><code>bangalore_wards_park_area.gpkg</code> layer with total park area for each ward.</li>
</ul>
<p>We can now use overlay techniques to carry out the suitability analysis using the above layers.</p>
<ol style="list-style-type: decimal">
<li>Locate <code>30min_isochrone.gpkg</code>, <code>metro_station_buffer_reprojected.gpkg</code> and <code>bangalore_wards_park_area.gpkg</code> layers and add them to QGIS. Search and locate the <strong>Vector overlay → Intersection</strong> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay1.png" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Select <code>30min_isochrone</code> as the <em>Input layer</em> and <code>metro_station_buffer_reprojected</code> as the <em>Overlay layer</em>. Name the <em>Intersection</em> output as <code>intersection.gpkg</code>. Click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay2.png" />

</div>
<ol start="3" style="list-style-type: decimal">
<li>The resulting <code>intersection</code> layer represents the area that meets 2 of our criteria. Now time to apply the 3rd criteria. Search and locate the <strong>Vector analysis → Overlap analysis</strong> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay3.png" />

</div>
<ol start="4" style="list-style-type: decimal">
<li>Select <code>bangalore_wards_park_area.gpkg</code> as the <em>Input layer</em>. Select <code>intersection</code> as the <em>Overlay layer</em>. Name the <em>Output layer</em> as <code>park_intersection_overlap.gpkg</code> and click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay4.png" />

</div>
<ol start="5" style="list-style-type: decimal">
<li>The resulting layer <code>park_intersection_overlap</code> adds 2 new columns to the original park layer: <code>intersection_area</code> and <code>intersection_pc</code>. For each ward polygon - we now know what percentage of the polygon intersects with our region of interest. If we assume the parks are evenly distributed throughout the ward, we can calculate the park area in the area of interest using the <code>intersection_pc</code> attribute. Search for the <em>Vector Table → Field Calculator</em> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay5.png" />

</div>
<ol start="6" style="list-style-type: decimal">
<li>Select the <em>Output file</em> as <code>park_intersection_percentage_area.gpkg</code>. Name the <em>Output field name</em> as <code>perc_area</code>. Enter the following expression and click <em>OK</em>.</li>
</ol>
<pre><code>(&quot;intersection_pc&quot; * &quot;PARK_AREA&quot;)/100</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/overlay6.png" />

</div>
<ol start="7" style="list-style-type: decimal">
<li>We are almost done. We now know what is the total area of parks in the intersection region for each ward. We can now assign a rank to them. Search for the <em>Vector Table → Add autoincremental field</em> algorithm. Double-click to launch it.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay7.png" />

</div>
<ol start="8" style="list-style-type: decimal">
<li>Select <code>park_intersection_percentage_area</code> as the <em>Input layer</em>. Enter <code>RANK</code> as the <em>Field name</em> and <code>1</code> as the <em>Start values at</em>. Expand the <em>Advanced parameter</em> section and select <code>perc_area</code> as the <em>Sort expression</em>. Un-check the <em>Sort ascending</em> box. Name the <em>Incremented</em> output layer as <code>bangalore_ward_rank.gpkg</code> and click <em>Run</em>.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay8.png" />

</div>
<ol start="9" style="list-style-type: decimal">
<li>Right-click the resulting <code>bangalore_ward_rank</code> layer and select <em>Filter</em>. Enter the following expression to select the Top 10 wards.</li>
</ol>
<pre><code>&quot;RANK&quot; &lt;= 10</code></pre>
<div class="figure">
<img src="images/spatial_data_viz/overlay9.png" />

</div>
<ol start="10" style="list-style-type: decimal">
<li>You will see the top 10 wards on the map. Click <em>Open the Layer Styling Panel</em> and switch to the <em>Labels</em> tab. Choose <em>Single labels</em> and <code>RANK</code> as the <em>Value</em>. A label with the rank of the ward will be displayed on the map.</li>
</ol>
<div class="figure">
<img src="images/spatial_data_viz/overlay10.png" />

</div>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>Delhi PM2.5 concentrations. Downloaded from <a href="https://openaq.org/">OpenAQ</a> <a href="https://openaq.org/#/countries?_k=dmlk2k">data download</a> service. Source data from Central Pollution Control Board (CPCB) India and EPAAirNow DOC.</li>
<li>OSM Tile Layer, Bangalore Metro Stations : (c) OpenStreetMap contributors</li>
<li>India Village-Level Geospatial Socio-Economic Data Set. Meiyappan, P., P. S. Roy, A. Soliman, T. Li, P. Mondal, S. Wang, and A. K. Jain. 2018. India Village-Level Geospatial Socio-Economic Data Set: 1991, 2001. Palisades, NY: NASA Socioeconomic Data and Applications Center (SEDAC). <a href="https://doi.org/10.7927/H4CN71ZJ" class="uri">https://doi.org/10.7927/H4CN71ZJ</a>. Accessed 15 February 2020.</li>
<li>Census 2001 Districts: Downloaded from <a href="https://github.com/datameet/maps/tree/master/States">Datameet Spatial Data repository</a>.</li>
<li>Oxford Point Cloud. DTM, and DSM. Downloaded from <a href="https://environment.data.gov.uk/DefraDataDownload/">Defra Data Services Platform</a>. Crown Copyright 2019</li>
<li>Kathmandu University Ground Drone Imagery. Downloaded from <a href="https://map.openaerialmap.org/#/85.53695037961006,27.61776421799196,20/user/59f0ecea31eff4000c3804fd/5a00c096bac48e5b1cf75232?_k=tkjpjw">OpenAerialMap</a>. Captured by <a href="https://werobotics.org/">WeRobotics</a></li>
<li>Bangalore Sentinel-2 Imagery. Downloaded from <a href="https://scihub.copernicus.eu/">Copernicus Open Access Hub</a>. Copyright European Space Agency - ESA.</li>
<li>Travel Times for Bangalore. Data retrieved from Uber Movement, (c) 2020 Uber Technologies, Inc., <a href="https://movement.uber.com" class="uri">https://movement.uber.com</a>.</li>
<li>Bangalore Ward Maps Provided by <a href="http://projects.datameet.org/Municipal_Spatial_Data/">Spatial Data of Municipalities (Maps) Project</a> by Data{Meet}.</li>
<li>Karnataka Population Grid 2020: Downloaded from <a href="https://www.worldpop.org/geodata/summary?id=6527">WorldPop</a> - School of Geography and Environmental Science, University of Southampton; Department of Geography and Geosciences, University of Louisville; Departement de Geographie, Universite de Namur) and Center for International Earth Science Information Network (CIESIN), Columbia University (2018). Global High Resolution Population Denominators Project - Funded by The Bill and Melinda Gates Foundation (OPP1134076). <a href="https://dx.doi.org/10.5258/SOTON/WP00645" class="uri">https://dx.doi.org/10.5258/SOTON/WP00645</a></li>
<li><a href="http://opencity.in/documents/bbmp-list-of-parks-wardwise">BBMP: List of Parks - wardwise</a>: Downloaded from OpenCity Urban Data Portal by Oorvani Foundation and DataMeet.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author</p>
<p>If you would like to use this material for commercial use or for teaching a course, kindly <a href="https://spatialthoughts.com/contact/">contact me</a> for terms.</p>
<p>© 2020 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
