<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ujaval Gandhi" />


<title>Spatial Data Visualization and Analytics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Spatial Data Visualization and Analytics</h1>
<h3 class="subtitle">Learn techniques for working with all types of spatial datasets.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#spatial-data-model">Spatial Data Model</a></li>
<li><a href="#spatial-data-formats">Spatial Data Formats</a></li>
<li><a href="#spatial-data-types">Spatial Data Types</a></li>
</ul></li>
<li><a href="#introduction-to-qgis">Introduction to QGIS</a><ul>
<li><a href="#plugins">Plugins</a></li>
</ul></li>
<li><a href="#points">Points</a><ul>
<li><a href="#exercise-mapping-air-quality">Exercise: Mapping Air Quality</a></li>
</ul></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>


<hr />
<p><strong>This course is also offered as an in-person class. If you would like to attend one of my workshops, visit <a href="https://spatialthoughts.com/events/">www.spatialthoughts.com/events</a> to know details of upcoming classes. Please sign up for <a href="https://mailchi.mp/1d44f6c0c955/spatialthoughts">my mailing list</a> to know when new sessions are scheduled.</strong></p>
<hr />

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="spatial-data-model" class="section level2">
<h2>Spatial Data Model</h2>
<p>geometry + properties</p>
<p>shape + table</p>
<p>geometry = coordinates + reference properties = type + data</p>
<p>A GeoJSON representation</p>
<pre><code> {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [ 77.58270263671875, 12.963074139604124]
      },
      &quot;properties&quot;: {
        &quot;name&quot;: &quot;Bengaluru&quot;
      }
  }</code></pre>
</div>
<div id="spatial-data-formats" class="section level2">
<h2>Spatial Data Formats</h2>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Non-Spatial Data</strong></th>
<th align="left"><strong>Spatial Data</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Text</td>
<td align="left">csv, json, xml</td>
<td align="left">csv, geojson, gml, kml</td>
</tr>
<tr class="even">
<td align="left">Binary/Compressed</td>
<td align="left">xlsx, zip</td>
<td align="left">shapefile, geopackage</td>
</tr>
<tr class="odd">
<td align="left">Images</td>
<td align="left">tiff, jpg, png</td>
<td align="left">geotiff, jped2000</td>
</tr>
<tr class="even">
<td align="left">Databases</td>
<td align="left">SQLite, PostgreSQL, Oracle</td>
<td align="left">Spatialite, PostGIS, Oracle Spatial</td>
</tr>
</tbody>
</table>
</div>
<div id="spatial-data-types" class="section level2">
<h2>Spatial Data Types</h2>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Sub Types</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Vector</td>
<td align="left">Point, Line (Curve), Polygon (Surface)</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">MultiPoint, MultiLine, MultiPolyogn</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">PointZ, LineZ, LineM, Multipatch</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Point Cloud</td>
</tr>
<tr class="odd">
<td align="left">Raster</td>
<td align="left">Grids</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Mesh</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Tiles</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="introduction-to-qgis" class="section level1">
<h1>Introduction to QGIS</h1>
<div id="plugins" class="section level2">
<h2>Plugins</h2>
</div>
</div>
<div id="points" class="section level1">
<h1>Points</h1>
<p>The simplest representation of spatial data can be done using a table. A place can be represented using a pair of coordinates - Latitude and Longitude - with other attribute information about the place. Many spatial data source come in this form. Excel sheets, CSV files, database tables etc.</p>
<div id="exercise-mapping-air-quality" class="section level2">
<h2>Exercise: Mapping Air Quality</h2>
<p>Worsening air quality is a severe problem in many countries around the world. India - particularly - Delhi suffers from <a href="https://ig.ft.com/india-pollution/">acute problems of high pollution levels</a>.One of the first steps to better understand the problem, is to have continous monitoring of air quality across the cities. Many organizations have stepped up and setup such sensors that collect air quaility data and make it publicly available. <a href="https://openaq.org/">OpenAQ</a> is a platform that collects this data from all public sources and makes it available in an easy to use form.</p>
<blockquote>
<blockquote>
<p>If you are interested in this topic, <a href="http://www.urbanemissions.info/">Urban Emissions</a> has a lot of relevant information and datasets for India.</p>
</blockquote>
</blockquote>
<p>For this exercise, we will take the sensor data for <a href="https://blissair.com/what-is-pm-2-5.htm">PM2.5 concentrations</a> 1 day and map it. The aim is to turn this tabular data info an informative spatial data visualization.</p>
<p>For this exercise, we are using daily average data for Delhi, India for February 15, 2020. This data was downloaded from <a href="https://openaq.org/#/countries?_k=dmlk2k">OpenAQ Data Download</a></p>
<div class="figure">
<img src="images/spatial_data_viz/aq1.png" />

</div>
<p>Open the <code>openaq.csv</code> file in a text editor and examine it. Each row of data contains data from 1 monitoring station. The <code>latitude</code> and <code>longitude</code> column contain the coordinates of the station and the <code>value</code> contains the daily average PM2.5 concentration</p>
<div class="figure">
<img src="images/spatial_data_viz/aq0.png" />

</div>
<p>Tabular data in text files fall into the category of <strong>Delimited Text</strong> files, such as this can be imported in QGIS via <em>Data Source Manager</em>. Click <em>Open Data Source Manager</em> button.</p>
<p><img src="images/spatial_data_viz/aq2.png" /> Browse to the <code>openaq.csv</code> file and open it. As we want to import this file as points, select <em>Point coordinates</em>. Choose <code>longitude</code> as <em>X Field</em> and <code>latitude</code> as <em>Y Field</em>. Click <em>Add</em>.</p>
<p><img src="images/spatial_data_viz/aq3.png" /> You will see the tabular data now loaded in QGIS canvas as a spatial data layer. Use the <em>Identify</em> button and click on any of the point. You will see the attribute data that is attached to each point.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq4.png" />

</div>
<p>Through we can see the point distribution is across the city of Delhi, we are missing the context on where is point is located. A basemap layer will help us understand this data better. The <strong>QuickMapServices</strong> plugin gives us ready access to many different types of basemaps. Go to <strong>Web → QuickMapServices → OSM → OpenStreetMap monochrome</strong> layer.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq5.png" />

</div>
<p>A new layer will get added to the <em>Layers</em> panel and the <em>Canvas</em>. Now you can see the points in the context of the city and surroundings. Let’s style the point layer better now. Click <em>Open the Layer Styling Panel</em>.</p>
<p><img src="images/spatial_data_viz/aq6.png" /> We will color each point according to the observed PM2.5 value. Choose <code>Graduated</code> renderer and <code>value</code> as the <em>Value</em> column. Set the number of <em>Classes</em> to <code>6</code> and click <em>Classify</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq7.png" />

</div>
<p>For the class ranges to have some meaning, we need to link them to the commonly used scale. India has adopted <a href="https://pib.gov.in/newsite/PrintRelease.aspx?relid=110654">National Air Quality Index</a> with the folowing definitions.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq_naqi.png" alt="Source: The National Air Quality Index, Minister for Environment, Forests &amp; Climate Change, India" />
<p class="caption">Source: The National Air Quality Index, Minister for Environment, Forests &amp; Climate Change, India</p>
</div>
<p>Let’s adjust the class values to match those defined in the National Air Quality Index. We can also chage the <em>Legend</em> labels to the human-readable category names. You can double-click each class range and edit it.</p>
<p><img src="images/spatial_data_viz/aq8.png" /> As you edit the categories, the map visualization will change accordingly. The layer legend will also show the legend labels now.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq9.png" />

</div>
<p>We can change the color also to match those defined in the index. Select the dropdown next to the color ramp and select the <code>RdYlGn</code> (Red-Yellow-Green) ramp.</p>
<p><img src="images/spatial_data_viz/aq10.png" /> We want the ramp to go from Green (low PM2.5 values) to Red (high PM2.5 values) - so click the dropdown again and select <em>Invert Color Ramp</em>. <img src="images/spatial_data_viz/aq11.png" /> We will add labels to the points now. Switch to the <em>Labels</em> tab. <img src="images/spatial_data_viz/aq12.png" /></p>
<p>Choose <code>Single labels</code> and <code>value</code> as <em>Value</em>. Scroll down and check <em>Formatted numbers</em> and change the <em>Decimal places</em> to <code>0</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq13.png" />

</div>
<p>Next, switch to the <em>Background</em> tab. Check <em>Draw background</em> and adjust the <em>Size X</em> and <em>Size Y</em>. <img src="images/spatial_data_viz/aq14.png" /> Scroll down to the <em>Fill color</em> section. We want the fill color for each box to match the color of the associated point. Click the <em>Data defined override</em> button and choose <em>Edit</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq15.png" />

</div>
<p>Double-click the <code>@symbol_color</code> variable to add it to the expression. Click OK.</p>
<p><img src="images/spatial_data_viz/aq16.png" /> You will see the map change and the label shields will have the color matching the category based on the values. We will move the labels slightly above so the points are also seen. Switch to the <em>Placement</em> tab and select <em>Offset from point</em>. Check the <em>Offset Y</em> to <code>-5</code>. <img src="images/spatial_data_viz/aq17.png" /> Lastly, go the <em>Callouts</em> tab and check <em>Draw callouts</em> to make it easy to see which labels belong to which point.</p>
<p><img src="images/spatial_data_viz/aq18.png" /> It is a good idea to save out work. Click the <em>Save Project</em> button and save it as <code>air_quality.qgz</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq19.png" />

</div>
<p>You can see most of the labels are legible, but some are too close and feel a bit cluttered. We can fix them by manually adjusting the placement. Right-click anywhere on the toolbar area and enable the <em>Label Toolbar</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq20.png" />

</div>
<p>Click the <em>Move a Label</em> button. Click <em>OK</em> on the <em>Auxiliary Storage</em> prompt.</p>
<p><img src="images/spatial_data_viz/aq21.png" /> With the <em>Move a Label</em> button active, click ona any label to select it. Click at the place you want to move it to, and it will be placed there. Once you are satisfied, save the project. It is time to export our map. Go to <strong>Project → New Print Layout…</strong>. Leave the name empty and click <em>OK</em>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq22.png" />

</div>
<p>Print Layouts are a way to compose a static map with various elements such as labels, legends, north arrow, scalebar etc. Go to <strong>Add Item → Add Map</strong>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq23.png" />

</div>
<p>Drag a rectangle where you want the map to be rendered. Once you leg go of you your mouse button, the map from the main canvas will be loaded in the region.</p>
<p><img src="images/spatial_data_viz/aq24.png" /> Next, we will add a <em>Rectangle</em> which will hold the tile, legend and attribution.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq25.png" />

</div>
<p>Place the rectangle on the top-right hand corner and change the <em>Corner radius</em> to <code>10</code>.</p>
<p><img src="images/spatial_data_viz/aq26.png" /> Next, add a <em>Label</em> with the title <code>Average PM2.5 Concentration (μg/m3)</code> and date <code>15 Bebruary, 2020</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq27.png" />

</div>
<p>Add another <em>Label</em> with the attribution text <code>Data Source: Central Pollution Control Board, EPA AirNow DOS. Downloaded from OpenAQ.org</code>. Now we will add a legend, so our users know how to interpret various colors on the map. Go to <strong>Add Item → Add Legend</strong></p>
<div class="figure">
<img src="images/spatial_data_viz/aq28.png" />

</div>
<p>Drag a box to insert the legend. Go to the <em>Item Properties</em> tab and turn-off <em>Auto update</em>. Remove the <code>OpenStreetMap monochrome</code> layer and set the <code>openaq</code> group label to <em>Hidden</em>. <img src="images/spatial_data_viz/aq29.png" /></p>
<p>The default legend placement is vertical - in a single column. We can change it to be in multiple columns to make it span horizontal. Scroll down to the <em>Columns</em> section and change the <em>Count</em> to <code>2</code> and check <em>Split layers</em> button.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq30.png" />

</div>
<p>In the <em>Main Properties</em> section, enter a <em>Title</em> for the legend as <code>Air Quality Index Category</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq31.png" />

</div>
<p>Once you are satisfied with the map, we can export the map. You can export the composition as an <strong>Image</strong> if you wanted to use it in a website, email, slideshow etc. You can also export it to as an <strong>SVG</strong> so it can be furhter edited in a graphics program such as <a href="https://inkscape.org/">InkScape</a>. But the most common format for maps is still a PDF.</p>
<div class="figure">
<img src="images/spatial_data_viz/shp_to_pdf.png" alt="Credit: Atanas Entchev @atanas" />
<p class="caption"><a href="https://twitter.com/atanas/status/1181944494507413504?s=20">Credit: Atanas Entchev @atanas</a></p>
</div>
<p>So let’s export our map to a PDF. Before exporting, switch to the <em>Layout</em> tab and set the <em>Export resolution</em> to <code>100</code> dpi. Go to <strong>Layout → Export as PDF</strong>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq32.png" />

</div>
<p>In the <em>PDF Export Options</em>, you can check <em>Create Geospatial PDF (GeoPDF)</em>. GeoPDF is an enhanced PDF format that is spatially aware and preserves layer and attribute information. Click <em>Save</em> and save the output as <code>delhi_air_quality.pdf</code>.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq33.png" />

</div>
<p>If you open the resulting PDF in a compatible reader such as <a href="https://get.adobe.com/reader/">Adobe Acrobat</a>, you can toggle layer visibility, query attributes by features, measure distances and so on.</p>
<div class="figure">
<img src="images/spatial_data_viz/aq34.png" />

</div>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>Delhi PM2.5 concentrations. Downloaded from <a href="https://openaq.org/">OpenAQ</a> <a href="https://openaq.org/#/countries?_k=dmlk2k">data download</a> service. Source data from Central Pollution Control Board (CPCB) India and EPAAirNow DOC.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a>. You are free to use the material in any form as you wish. Kindly give appropriate credit to the original author.</p>
<p>© 2020 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
