<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="working-with-pandas" class="section level1">
<h1>Working with Pandas</h1>
<div class="figure">
<img src="images/python_foundation/pandas-logo.png" />

</div>
<p>Pandas is a powerful library for working with data. Pandas provides fast and easy functions for reading data from files, and analyzing it.</p>
<p>Pandas is based on another library called <code>numpy</code> - which is widely used in scientific computing. Pandas extends <code>numpy</code> and provides new data types such as <strong>Index</strong>, <strong>Series</strong> and <strong>DataFrames</strong>.</p>
<p>Pandas implementation is very fast and efficient - so compared to other methods of data processing - using <code>pandas</code> results is simpler code and quick processing. We will now re-implement our code for reading a file and computing distance using Pandas.</p>
<p>By convention, <code>pandas</code> is commonly imported as <code>pd</code></p>
<pre class="python"><code>import pandas as pd</code></pre>
<div id="reading-files" class="section level2">
<h2>Reading Files</h2>
<pre class="python"><code>import os
data_pkg_path = &#39;data&#39;
filename = &#39;worldcities.csv&#39;
path = os.path.join(data_pkg_path, filename)</code></pre>
<p>A <strong>DataFrame</strong> is the most used Pandas object. You can think of a DataFrame being equivalent to a Spreadsheet or an Attribute Table of a GIS layer.</p>
<p>Pandas provide easy methods to directly read files into a DataFrame. You can use methods such as <code>read_csv()</code>, <code>read_excel()</code>, <code>read_hdf()</code> and so forth to read a variety of formats. Here we will read the <code>worldcitites.csv</code> file using <code>read_csv()</code> method.</p>
<pre class="python"><code>df = pd.read_csv(path)</code></pre>
<p>Once the file is read and a DataFrame object is created, we can inspect it using the <code>head()</code> method.</p>
<pre class="python"><code>print(df.head())</code></pre>
<pre><code>          city   city_ascii      lat       lng        country iso2 iso3  \
0        Tokyo        Tokyo  35.6850  139.7514          Japan   JP  JPN   
1     New York     New York  40.6943  -73.9249  United States   US  USA   
2  Mexico City  Mexico City  19.4424  -99.1310         Mexico   MX  MEX   
3       Mumbai       Mumbai  19.0170   72.8570          India   IN  IND   
4    São Paulo    Sao Paulo -23.5587  -46.6250         Brazil   BR  BRA   

         admin_name  capital  population          id  
0             Tōkyō  primary  35676000.0  1392685764  
1          New York      NaN  19354922.0  1840034016  
2  Ciudad de México  primary  19028000.0  1484247881  
3       Mahārāshtra    admin  18978000.0  1356226629  
4         São Paulo    admin  18845000.0  1076532519  </code></pre>
<p>There is also a <code>info()</code> method that shows basic information about the dataframe, such as number of rows/columns and data types of each column.</p>
<pre class="python"><code>print(df.info())</code></pre>
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 15493 entries, 0 to 15492
Data columns (total 11 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   city        15493 non-null  object 
 1   city_ascii  15493 non-null  object 
 2   lat         15493 non-null  float64
 3   lng         15493 non-null  float64
 4   country     15493 non-null  object 
 5   iso2        15462 non-null  object 
 6   iso3        15493 non-null  object 
 7   admin_name  15302 non-null  object 
 8   capital     5246 non-null   object 
 9   population  13808 non-null  float64
 10  id          15493 non-null  int64  
dtypes: float64(3), int64(1), object(7)
memory usage: 1.3+ MB
None</code></pre>
</div>
<div id="filtering-data" class="section level2">
<h2>Filtering Data</h2>
<p>Pandas have many ways of selecting and filtered data from a dataframe. We will now see how to use the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#boolean-indexing">Boolean Filtering</a> to filter the dataframe to rows that match a condition.</p>
<pre class="python"><code>home_country = &#39;India&#39;
filtered = df[df[&#39;country&#39;] == home_country]
print(filtered)</code></pre>
<pre><code>           city city_ascii      lat      lng country iso2 iso3  \
3        Mumbai     Mumbai  19.0170  72.8570   India   IN  IND   
5         Delhi      Delhi  28.6700  77.2300   India   IN  IND   
7       Kolkata    Kolkata  22.4950  88.3247   India   IN  IND   
34      Chennai    Chennai  13.0900  80.2800   India   IN  IND   
36    Bengalūru  Bengaluru  12.9700  77.5600   India   IN  IND   
...         ...        ...      ...      ...     ...  ...  ...   
7305      Karūr      Karur  10.9504  78.0833   India   IN  IND   
7441     Jorhāt     Jorhat  26.7500  94.2167   India   IN  IND   
7583      Sopur      Sopur  34.3000  74.4667   India   IN  IND   
7681     Tezpur     Tezpur  26.6338  92.8000   India   IN  IND   
9384        Diu        Diu  20.7197  70.9904   India   IN  IND   

             admin_name capital  population          id  
3           Mahārāshtra   admin  18978000.0  1356226629  
5                 Delhi   admin  15926000.0  1356872604  
7           West Bengal   admin  14787000.0  1356060520  
34          Tamil Nādu    admin   7163000.0  1356374944  
36            Karnātaka   admin   6787000.0  1356410365  
...                 ...     ...         ...         ...  
7305        Tamil Nādu      NaN     76915.0  1356837900  
7441              Assam     NaN     69033.0  1356638741  
7583  Jammu and Kashmīr     NaN     63035.0  1356978065  
7681              Assam     NaN     58851.0  1356299437  
9384      Damān and Diu     NaN     23779.0  1356923516  

[212 rows x 11 columns]</code></pre>
<p>Filtered dataframe is a just view of the original data and we cannot make changes to it. We can save the filtered view to a new dataframe using the <code>copy()</code> method.</p>
<pre class="python"><code>country_df = df[df[&#39;country&#39;] == home_country].copy()</code></pre>
<p>To locate a particular row or column from a dataframe, Pandas providea <code>loc[]</code> and <code>iloc[]</code> methods - that allows you to <em>locate</em> particular slices of data. Learn about <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#different-choices-for-indexing">different indexing methods</a> in Pandas. Here we can use <code>iloc[]</code> to find the row matching the <code>home_city</code> name. Since <code>iloc[]</code> uses index, the <em>0</em> here refers to the first row.</p>
<pre class="python"><code>home_city = &#39;Bengaluru&#39;
filtered = country_df[country_df[&#39;city_ascii&#39;] == home_city]
print(filtered.iloc[0])</code></pre>
<pre><code>city           Bengalūru
city_ascii     Bengaluru
lat                12.97
lng                77.56
country            India
iso2                  IN
iso3                 IND
admin_name     Karnātaka
capital            admin
population     6.787e+06
id            1356410365
Name: 36, dtype: object</code></pre>
<p>Now that we have filtered down the data to a single row, we can select individual column values using column names.</p>
<pre class="python"><code>home_city_coordinates = (filtered.iloc[0][&#39;lat&#39;], filtered.iloc[0][&#39;lng&#39;])
print(home_city_coordinates)</code></pre>
<pre><code>(12.97, 77.56)</code></pre>
</div>
<div id="performing-calculations" class="section level2">
<h2>Performing calculations</h2>
<p>Let’s learn how to do calculations on a dataframe. We can iterate over each row and perform some calculations. But pandas provide a much more efficient way. You can use the <code>apply()</code> method to run a function on each row. This is fast and makes it easy to complex computations on large datasets.</p>
<p>The <code>apply()</code> function takes 2 arguments. A function to apply, and the axis along which to apply it. <code>axis=0</code> means it will be applied to columns and <code>axis=1</code> means it will apply to rows.</p>
<pre class="python"><code>from geopy import distance

def calculate_distance(row):
    city_coordinates = (row[&#39;lat&#39;], row[&#39;lng&#39;])
    return distance.geodesic(city_coordinates, home_city_coordinates).km

result = country_df.apply(calculate_distance, axis=1)
print(result)</code></pre>
<pre><code>3        837.185709
5       1738.638856
7       1552.637823
34       295.340107
36         0.000000
           ...     
7305     230.567496
7441    2312.574457
7583    2383.154991
7681    2195.314732
9384    1106.693243
Length: 212, dtype: float64</code></pre>
<p>We can add these results to the dataframe by simply assigning the result to a new column.</p>
<pre class="python"><code>country_df[&#39;distance&#39;] = result
print(country_df)</code></pre>
<pre><code>           city city_ascii      lat      lng country iso2 iso3  \
3        Mumbai     Mumbai  19.0170  72.8570   India   IN  IND   
5         Delhi      Delhi  28.6700  77.2300   India   IN  IND   
7       Kolkata    Kolkata  22.4950  88.3247   India   IN  IND   
34      Chennai    Chennai  13.0900  80.2800   India   IN  IND   
36    Bengalūru  Bengaluru  12.9700  77.5600   India   IN  IND   
...         ...        ...      ...      ...     ...  ...  ...   
7305      Karūr      Karur  10.9504  78.0833   India   IN  IND   
7441     Jorhāt     Jorhat  26.7500  94.2167   India   IN  IND   
7583      Sopur      Sopur  34.3000  74.4667   India   IN  IND   
7681     Tezpur     Tezpur  26.6338  92.8000   India   IN  IND   
9384        Diu        Diu  20.7197  70.9904   India   IN  IND   

             admin_name capital  population          id     distance  
3           Mahārāshtra   admin  18978000.0  1356226629   837.185709  
5                 Delhi   admin  15926000.0  1356872604  1738.638856  
7           West Bengal   admin  14787000.0  1356060520  1552.637823  
34          Tamil Nādu    admin   7163000.0  1356374944   295.340107  
36            Karnātaka   admin   6787000.0  1356410365     0.000000  
...                 ...     ...         ...         ...          ...  
7305        Tamil Nādu      NaN     76915.0  1356837900   230.567496  
7441              Assam     NaN     69033.0  1356638741  2312.574457  
7583  Jammu and Kashmīr     NaN     63035.0  1356978065  2383.154991  
7681              Assam     NaN     58851.0  1356299437  2195.314732  
9384      Damān and Diu     NaN     23779.0  1356923516  1106.693243  

[212 rows x 12 columns]</code></pre>
<p>We are done with our analysis and ready to save the results. We can further filter the results to only certain columns.</p>
<pre class="python"><code>filtered = country_df[[&#39;city_ascii&#39;,&#39;distance&#39;]]
print(filtered)</code></pre>
<pre><code>     city_ascii     distance
3        Mumbai   837.185709
5         Delhi  1738.638856
7       Kolkata  1552.637823
34      Chennai   295.340107
36    Bengaluru     0.000000
...         ...          ...
7305      Karur   230.567496
7441     Jorhat  2312.574457
7583      Sopur  2383.154991
7681     Tezpur  2195.314732
9384        Diu  1106.693243

[212 rows x 2 columns]</code></pre>
<p>Let’s rename the <code>city_ascii</code> column to give it a more readable name.</p>
<pre class="python"><code>filtered = filtered.rename(columns = {&#39;city_ascii&#39;: &#39;city&#39;})
print(filtered)</code></pre>
<pre><code>           city     distance
3        Mumbai   837.185709
5         Delhi  1738.638856
7       Kolkata  1552.637823
34      Chennai   295.340107
36    Bengaluru     0.000000
...         ...          ...
7305      Karur   230.567496
7441     Jorhat  2312.574457
7583      Sopur  2383.154991
7681     Tezpur  2195.314732
9384        Diu  1106.693243

[212 rows x 2 columns]</code></pre>
<p>Now that we have added filtered the original data and computed the distance for all cities, we can save the resulting dataframe to a file. Similar to read methods, Pandas have several write methods, such as <code>to_csv()</code>, <code>to_excel()</code> etc.</p>
<p>Here we will use the <code>to_csv()</code> method to write a CSV file. Pandas assigns an index column (unique integer values) to a dataframe by default. We specify <code>index=False</code> so that this index is not added to our output.</p>
<pre class="python"><code>output_filename = &#39;cities_distance_pandas.csv&#39;
output_dir = &#39;output&#39;
output_path = os.path.join(output_dir, output_filename)
filtered.to_csv(output_path, index=False)
print(&#39;Successfully written output file at {}&#39;.format(output_path))</code></pre>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>You will notice that the output file contains a row with the <code>home_city</code> as well. Modify the <code>filtered</code> dataframe to remove this row and write it to a file.</p>
<p>Hint: Use the Boolean filtering method we learnt earlier to select rows that do not match the <code>home_city</code>.</p>
<hr />
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
